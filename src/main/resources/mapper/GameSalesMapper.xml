<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.game.dao.GameSalesDao">

    <resultMap id="resultMap" type="com.example.game.model.GameSales">
        <id column="id" property="id"/>
        <result column="game_no" property="gameNo"/>
        <result column="game_name" property="gameName"/>
        <result column="game_code" property="gameCode"/>
        <result column="type" property="type"/>
        <result column="cost_price" property="costPrice" jdbcType="DECIMAL"/>
        <result column="tax" property="tax" jdbcType="DECIMAL"/>
        <result column="sale_price" property="salePrice" jdbcType="DECIMAL"/>
        <result column="date_of_sale" property="dateOfSale" jdbcType="TIMESTAMP"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <resultMap id="resultMapTotal" type="com.example.game.model.GameSalesVO">
        <result column="totalSalesNo" property="totalSalesNo"/>
        <result column="totalSalesAmount" property="totalSalesAmount"/>
    </resultMap>

    <select id="getTotalSales" resultMap="resultMapTotal">
        SELECT
        SUM(sale_price) AS totalSalesAmount,
        COUNT(*) AS totalSalesNo
        FROM
        game_sales
        <where>
            <if test="gameNo != null">
                game_no = #{gameNo}
            </if>
            <if test="saleDateGe != null">
                <![CDATA[ and date_of_sale>= DATE_FORMAT(#{saleDateGe},"%Y-%m-%d") ]]>
            </if>
            <if test="saleDateLe != null">
                <![CDATA[ and date_of_sale<= DATE_FORMAT(#{saleDateLe},"%Y-%m-%d") ]]>
            </if>
        </where>
    </select>

    <select id="selectGameSalesWithFilters" resultType="long">
        SELECT id
        FROM game_sales
        <where>
            <if test="priceLt != null">
                <![CDATA[ and sale_price < #{priceLt} ]]>
            </if>
            <if test="priceGt != null">
                <![CDATA[ and sale_price > #{priceGt} ]]>
            </if>
            <if test="saleDateLe != null">
                <![CDATA[ and date_of_sale<= DATE_FORMAT(#{saleDateLe},"%Y-%m-%d") ]]>
            </if>
            <if test="saleDateGe != null">
                <![CDATA[ and date_of_sale>= DATE_FORMAT(#{saleDateGe},"%Y-%m-%d") ]]>
            </if>
        </where>
        LIMIT #{page}, #{size}
    </select>
</mapper>
